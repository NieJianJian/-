## 第6章 类文件结构

　　实现语言无关性的基础仍然是虚拟机和字节码存储格式。Java虚拟机不和包括Java在内的任何语言绑定，它只与"Class文件"这种特定的二进制文件格式所关联，Class文件中包含了Java虚拟机指令集和符号表以及若干其他辅助信息。

　　Java语言中的各种变量、关键字和运算符号的语义最终都是由多条字节码命令组合而成的。

***

### 1.Class文件的结构

　　**注**：任何一个Class文件都对应着唯一一个类或者接口的定义信息，但反过来说，类或接口并不一定都得定义在文件里（譬如类或接口可以通过类加载器直接生成）。并不一定以磁盘文件的形式存在。

　　**Class文件**是一组以8位字节为基础的二进制流，各个数据项目严格按照顺序紧凑地排列在Class文件之中，中间没有添加任何分隔符，当遇到需要占用8位字节以上空间地数据项时，则会按照高位在前的方式分割成若干个8位字节进行存储。

　　**Class文件格式**采用一种类似于C语言结构体的伪结构来存储，只有两种数据类型：无符号数和表。

* 无符号数：属于基本数据类型，以u1、u2、u4、u8来分别代表1个字节、2个字节、4个字节和8个字节的无符号数，可以用来描述数字、索引引用、数量值或者按照UTF-8编码构成的字符串值。

* 表：由多个无符号数或者其他表做为数据项构成的复合数据类型，以"_info"结尾。用于描述有层次关系的复合结构的数据，整个Class文件本质上就是一张表。

  Class文件格式如下表：

|      类型      |        名称         |          数量          |
| :------------: | :-----------------: | :--------------------: |
|       u4       |        magic        |           1            |
|       u2       |    minor_version    |           1            |
|       u2       |    major_version    |           1            |
|       u2       | constant_pool_count |           1            |
|    cp_info     |    constant_pool    | constant_pool_count -1 |
|       u2       |    access_flags     |           1            |
|       u2       |     this_class      |           1            |
|       u2       |     super_class     |           1            |
|       u2       |  interfaces_count   |           1            |
|       u2       |     interfaces      |    interfaces_count    |
|       u2       |    fields_count     |           1            |
|   field_info   |       fields        |      fields_count      |
|       u2       |    methods_count    |           1            |
|  method_info   |       methods       |     methods_count      |
|       u2       |  attributes_count   |           1            |
| attribute_info |     attributes      |    attributes_count    |

　　无论是无符号数还是表，当需要描述同一类型但数量不定的多个数据时，经常会使用一个前置的容量计数器加若干个连续的数据项的形式，这时称这一系列连续的某一类型的数据为某一类型的集合。

　　<font color=#FF0000>***Class文件表中的数据项，无论是顺序还是数量，甚至于数据存储的字节序这样的细节，都是被严格选定的，哪个字节代表什么含义，长度是多少，先后顺序如何，都不想允许改变。***</font>

### 1.1 魔数与Class文件的版本

　　每个Class文件的头4个字节称为魔数，用来确定这个文件是否为Class文件。值为：0xCAFEBABE。

　　